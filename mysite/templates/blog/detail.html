{% extends "base.html" %}
{% load staticfiles %}
{% block title %}
    首页
{% endblock title %}
{% block content %}

    <h1>{{blog.title}}</h1>
    <div>
        author:{{blog.author}}
        <i class="fas fa-eye" style="color: lightskyblue;"></i>{{ blog.total_views }}
        发布时间：{{ blog.created_time }}
        <a href="{% url 'blog:blog_update' blog.id %}">Edit</a>
        <a href="#" onclick="confirm_delete()">Delete</a>
    </div>
    <p>{{blog.body|safe}}</p>

    <div>
        <hr>
    {% if user.is_authenticated %}
        <div>
            <form
                action="{% url 'comment:post_comment' blog.id %}"
                method="POST"
            >
            {% csrf_token %}
                <div class="form-group">
                    <label for="body">
                        <strong>
                            response：
                        </strong>
                    </label>
                    <div>
            {{ comment_form.media }}
            {{ comment_form.body }}
        </div>>
                </div>
                <!-- 提交按钮 -->
                <button type="submit" class="btn btn-primary ">发送</button>
            </form>
        </div>
        <br>
    {% else %}
        <br>
        <h5 class="row justify-content-center">
            请<a href="{% url 'user:login' %}">登录</a>后回复
        </h5>
        <br>
    {% endif %}


        {% for comment in comments %}
        {{ comment.user }}:
        <br/>
        {{ comment.body|safe }}
        <br/>
        {% endfor %}
    </div>


    <script>
    // 删除文章的函数
    function confirm_delete() {
        // 调用layer弹窗组件
        layer.open({
            // 弹窗标题
            title: "确认删除",
            // 正文
            content: "确认删除这篇文章吗？",
            // 点击确定按钮后调用的回调函数
            yes: function(index, layero) {
                // 指定应当前往的 url
                location.href='{% url "blog:blog_delete" blog.id %}'
            },
        })
    }

</script>

<script src="{% static 'ckeditor/ckeditor/plugins/prism/lib/prism/prism_patched.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'prism/prism.css' %}">

{% endblock content %}

{% block right_content %}
            {{ toc|safe }}
{% endblock right_content %}